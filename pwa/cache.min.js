"use strict";(function(root,factory){if(typeof module==="object"&&module.exports){module.exports=factory()}else if(typeof define==="function"&&define.amd){define([],factory)}else{root.serviceWorker=factory()}})(this,function(){var serviceWorker=function(){var _instance=this;var onCachedListeners=[];var onOnlineListeners=[];function generateEventHandler(array,isCachedHandler){return function(callback){array.push(callback);if(_instance.isCached===isCachedHandler){callback()}return function(){var index=array.indexOf(callback);if(index>=0){array.splice(index,1);return true}else{return false}}}}var alreadyInitialized=false;var subscriptionPromise;var controllerPromise;if("Promise"in window){controllerPromise=new Promise(function(resolve){var interval=setInterval(function(){if(navigator.serviceWorker.controller){clearInterval(interval);resolve()}},50)})}this.init=function(options){if(alreadyInitialized){return}alreadyInitialized=true;options=options||{};if("serviceWorker"in navigator){navigator.serviceWorker.addEventListener("message",function(event){if(event.data&&event.data.type&&event.data.type==="krugurt"){if(event.data.isCached){onCachedListeners.forEach(function(listener){listener()})}else{onOnlineListeners.forEach(function(listener){listener()})}_instance.isCached=event.data.isCached}});if(navigator.serviceWorker.controller){subscriptionPromise=navigator.serviceWorker.ready.then(function(registration){return registration.pushManager.getSubscription()})}else{subscriptionPromise=navigator.serviceWorker.register(options.url||"/sw.min.js").then(function(registration){return registration.pushManager.getSubscription().then(function(subscription){if(subscription){return subscription}return registration.pushManager.subscribe({userVisibleOnly:true})})}).catch(function(rejection){if(options.forceReload){location.reload()}return Promise.reject(rejection)})}}};this.onCached=generateEventHandler(onCachedListeners,true);this.onOnline=generateEventHandler(onOnlineListeners,false);this.add=function(request){if("serviceWorker"in navigator){var cachingList=[];if(typeof request==="string"||(request===Object(request)&&"url"in request)){cachingList=[request]}else if(request instanceof Array){cachingList=request}if(controllerPromise){controllerPromise.then(function(){navigator.serviceWorker.controller.postMessage({"type":"krugurt","add":JSON.stringify(cachingList)})})}}};this.remove=function(request){if("serviceWorker"in navigator){var removingList=[];if(typeof request==="string"||(request===Object(request)&&"url"in request)){removingList=[request]}else if(request instanceof Array){removingList=request}if(controllerPromise){controllerPromise.then(function(){navigator.serviceWorker.controller.postMessage({"type":"krugurt","remove":JSON.stringify(removingList)})})}}};this.isCached=false};return new serviceWorker});